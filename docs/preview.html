<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Preview ‚Äî Liste blanche (envoyeur)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root{
      --bg:#0b0f14; --card:#121821; --card2:#0f1620; --stroke:#1f2a37;
      --text:#e6edf3; --dim:#9fb0c0; --focus:#334155; --shadow:0 12px 40px rgba(0,0,0,.45);
      --r:14px; --rsm:10px;
    }
    *,*:before,*:after{box-sizing:border-box}
    body{
      margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,"Helvetica Neue",Arial;
      background:
        radial-gradient(1200px 600px at 20% -10%, #132034 0%, transparent 60%),
        radial-gradient(900px 500px at 110% 0%, #1a2334 0%, transparent 60%),
        var(--bg);
      color:var(--text);
    }
    .wrap{max-width:420px;margin:40px auto 64px;padding:0 16px}
    .card{
      background:linear-gradient(180deg,var(--card),var(--card2));
      border:1px solid var(--stroke); border-radius:var(--r); box-shadow:var(--shadow);
      padding:18px 16px;
    }
    h1{font-size:22px;margin:0 2px 10px}
    .sub{color:var(--dim);font-size:13px;margin:0 2px 14px}
    label{display:block;margin:10px 2px 6px;font-size:13px;color:var(--dim)}
    input,select{
      width:100%;height:44px;padding:10px 12px;border-radius:var(--rsm);
      border:1px solid var(--stroke); background:#0e141c; color:var(--text); outline:none;
      transition:.15s border,.15s box-shadow;
    }
    input:focus,select:focus{border-color:var(--focus);box-shadow:0 0 0 3px rgba(51,65,85,.35)}
    .row{display:flex;gap:10px}
    .col{flex:1}

    /* Boutons compacts (emoji) */
    .btn-icon{
      height:28px; min-width:28px; padding:0 8px;
      border-radius:8px; border:1px dashed var(--stroke);
      background:#0a1220; color:#cfe1ff; cursor:pointer; font-size:16px; line-height:28px;
      display:inline-flex;align-items:center;justify-content:center;
    }
    .btn-icon:hover{background:#0d1729}

    /* CTA d√©sactiv√© du preview */
    .btn{
      width:100%; height:46px; border:0; border-radius:12px; cursor:not-allowed; font-weight:700; font-size:15px; color:#fff;
      background: radial-gradient(circle at 20% 20%, #8b5cf6, #06b6d4, #22c55e);
      box-shadow:0 10px 24px rgba(34,197,94,.2); margin-top:14px; opacity:.6;
    }

    /* Suggestions */
    .suggest{position:relative;margin-top:6px}
    .suggest-list{
      position:absolute;left:0;right:0;top:100%;z-index:20;margin-top:6px;
      background:#0d1420;border:1px solid var(--stroke);border-radius:10px;box-shadow:var(--shadow);
      display:none; max-height:220px; overflow:auto;
    }
    .s-item{display:flex;align-items:center;justify-content:space-between;gap:8px;
      padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.04); cursor:pointer;}
    .s-item:last-child{border-bottom:0}
    .s-primary{font-weight:700}
    .s-secondary{color:var(--dim);font-size:12px}
    .s-actions{display:flex;gap:6px}
    .chip-del{
      background:#1a2433;border:1px solid #223046;color:#cbd5e1;border-radius:8px;padding:2px 6px;font-size:12px;cursor:pointer;
    }

    /* Inline save */
    .inline-save{display:none;gap:6px;align-items:center;margin-top:8px}
    .inline-save input{
      height:36px; padding:8px 10px; border-radius:8px; font-size:14px;
    }
    .inline-save .ok{background:#0f2a18;border:1px solid #1f6d3a}
    .inline-save .ko{background:#2a0f15;border:1px solid #6d1f2c}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" aria-label="Preview Listes blanches">
      <h1>Preview ‚Äî Liste blanche (envoyeur)</h1>
      <p class="sub">Enregistre un num√©ro avec un pseudo, puis retrouve-le en un clic dans le champ.</p>

      <label for="wallet">Ton wallet (exp√©diteur)</label>
      <input id="wallet" placeholder="0xABCDEF..." autocomplete="off"/>

      <div class="row">
        <div class="col">
          <label for="currency">Token</label>
          <select id="currency"><option>USDT</option><option>USDC</option><option>ETH</option></select>
        </div>
        <div class="col">
          <label for="amount">Montant (crypto)</label>
          <input id="amount" placeholder="0.01" inputmode="decimal"/>
        </div>
      </div>

      <label for="network">R√©seau</label>
      <select id="network"><option>Ethereum</option><option>Polygon</option><option>BNB Chain</option><option>Solana</option></select>

      <!-- === Zone liste blanche === -->
      <label for="phone">Num√©ro du destinataire</label>
      <div class="suggest">
        <input id="phone" placeholder="+33..." autocomplete="off"/>
        <div id="suggestList" class="suggest-list" role="listbox"></div>
      </div>

      <!-- boutons compacts (üìñ puis üíæ) -->
      <div class="row" style="margin-top:8px">
        <button id="showAllBtn" class="btn-icon" type="button" title="Afficher mes contacts">üìñ</button>
        <button id="saveBtn" class="btn-icon" type="button" title="Enregistrer ce num√©ro">üíæ</button>
      </div>

      <!-- petit champ inline pour le pseudo -->
      <div id="inlineSave" class="inline-save">
        <input id="aliasInput" placeholder="Nom / pseudo" autocomplete="off" />
        <button id="aliasOk" class="btn-icon ok" type="button" title="Valider">‚úÖ</button>
        <button id="aliasKo" class="btn-icon ko" type="button" title="Annuler">‚úñÔ∏è</button>
      </div>

      <button class="btn" disabled>G√©n√©rer le lien (d√©sactiv√© dans le preview)</button>
    </div>
  </div>

  <script>
    const LS_KEY = "linkisend_contacts"; // [{ id, name, phone, created }]
    const $ = (s)=>document.querySelector(s);
    const phoneInput = $("#phone");
    const suggestEl = $("#suggestList");
    const inlineSave = $("#inlineSave");
    const aliasInput = $("#aliasInput");

    // --- storage ---
    function loadContacts(){ try { return JSON.parse(localStorage.getItem(LS_KEY)||"[]"); } catch { return []; } }
    function saveContacts(list){ localStorage.setItem(LS_KEY, JSON.stringify(list)); }
    function addContact(name, phone){
      const list = loadContacts();
      const idx = list.findIndex(c=>c.phone===phone);
      const item = { id:(crypto.randomUUID?crypto.randomUUID():String(Date.now())), name, phone, created:Date.now() };
      if (idx>=0) list[idx]=item; else list.unshift(item);
      saveContacts(list);
    }
    function removeContact(id){ saveContacts(loadContacts().filter(c=>c.id!==id)); }

    // --- suggest UI ---
    function closeSuggest(){ suggestEl.style.display="none"; suggestEl.innerHTML=""; }
    function openSuggest(){ suggestEl.style.display="block"; }

    function escapeHtml(str){ return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[s])); }

    function renderSuggest(filter=""){
      const data=loadContacts();
      const f=(filter||"").trim().toLowerCase();
      const rows=data.filter(c=>!f || c.name.toLowerCase().includes(f) || c.phone.includes(filter));
      suggestEl.innerHTML="";

      if (!rows.length){ closeSuggest(); return; } // <-- pas d'affichage si vide

      rows.forEach(c=>{
        const row=document.createElement("div");
        row.className="s-item";
        row.innerHTML=`
          <div>
            <div class="s-primary">${escapeHtml(c.name)}</div>
            <div class="s-secondary">${escapeHtml(c.phone)}</div>
          </div>
          <div class="s-actions">
            <button class="chip-del" data-id="${c.id}" type="button" aria-label="Supprimer">üóëÔ∏è</button>
          </div>
        `;
        row.addEventListener("click",(e)=>{
          const t=e.target;
          if (t && t.classList && t.classList.contains("chip-del")) return;
          phoneInput.value=c.phone; closeSuggest();
        });
        const del=row.querySelector(".chip-del");
        if (del){ del.addEventListener("click",(e)=>{ e.stopPropagation(); removeContact(c.id); renderSuggest(filter); }); }
        suggestEl.appendChild(row);
      });
      openSuggest();
    }

    // --- interactions ---
    phoneInput.addEventListener("focus", ()=>renderSuggest(phoneInput.value));
    phoneInput.addEventListener("input", ()=>renderSuggest(phoneInput.value));
    document.addEventListener("click",(e)=>{ if (!suggestEl.contains(e.target) && e.target!==phoneInput) closeSuggest(); });

    // affiche liste compl√®te
    $("#showAllBtn").addEventListener("click", ()=>{
      const has = loadContacts().length>0;
      if (!has){ closeSuggest(); return; }
      renderSuggest(""); openSuggest(); phoneInput.focus();
    });

    // ouvre le petit champ inline pour saisir le pseudo
    $("#saveBtn").addEventListener("click", ()=>{
      const phone = phoneInput.value.trim();
      if (!phone){ alert("Entre un num√©ro avant d‚Äôenregistrer."); return; }
      inlineSave.style.display="flex";
      aliasInput.value=""; aliasInput.focus();
    });

    // valider / annuler l'enregistrement inline
    $("#aliasOk").addEventListener("click", ()=>{
      const phone = phoneInput.value.trim();
      const name = aliasInput.value.trim();
      if (!name) { aliasInput.focus(); return; }
      addContact(name, phone);
      inlineSave.style.display="none";
      renderSuggest(phone); openSuggest();
    });
    $("#aliasKo").addEventListener("click", ()=>{
      inlineSave.style.display="none";
      aliasInput.value="";
    });
  </script>
</body>
</html>
