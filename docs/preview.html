<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Preview ‚Äî Liste blanche + Indicatif</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root{--bg:#0b0f14;--card:#121821;--card2:#0f1620;--stroke:#1f2a37;--text:#e6edf3;--dim:#9fb0c0;--focus:#334155;--shadow:0 12px 40px rgba(0,0,0,.45);--r:14px;--rsm:10px;}
    *,*:before,*:after{box-sizing:border-box}
    body{
      margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,"Helvetica Neue",Arial;
      background:
        radial-gradient(1200px 600px at 20% -10%, #132034 0%, transparent 60%),
        radial-gradient(900px 500px at 110% 0%, #1a2334 0%, transparent 60%),
        var(--bg);
      color:var(--text);
    }
    .wrap{max-width:420px;margin:40px auto 64px;padding:0 16px}
    .card{background:linear-gradient(180deg,var(--card),var(--card2));border:1px solid var(--stroke);border-radius:var(--r);box-shadow:var(--shadow);padding:18px 16px}
    h1{font-size:22px;margin:0 2px 10px}
    .sub{color:var(--dim);font-size:13px;margin:0 2px 14px}
    label{display:block;margin:10px 2px 6px;font-size:13px;color:var(--dim)}
    input,select{width:100%;height:44px;padding:10px 12px;border-radius:var(--rsm);border:1px solid var(--stroke);background:#0e141c;color:#e6edf3;outline:none;transition:.15s border,.15s box-shadow}
    input:focus,select:focus{border-color:var(--focus);box-shadow:0 0 0 3px rgba(51,65,85,.35)}
    .row{display:flex;gap:10px}
    .col{flex:1}

    /* CTA d√©sactiv√© du preview */
    .btn{width:100%;height:46px;border:0;border-radius:12px;cursor:not-allowed;font-weight:700;font-size:15px;color:#fff;
      background: radial-gradient(circle at 20% 20%, #8b5cf6, #06b6d4, #22c55e);box-shadow:0 10px 24px rgba(34,197,94,.2);margin-top:14px;opacity:.6}

    /* Boutons compacts (emoji) */
    .btn-icon{height:28px;min-width:28px;padding:0 8px;border-radius:8px;border:1px dashed var(--stroke);background:#0a1220;color:#cfe1ff;cursor:pointer;font-size:16px;line-height:28px;display:inline-flex;align-items:center;justify-content:center}
    .btn-icon:hover{background:#0d1729}

    /* Suggestions (contacts) */
    .suggest{position:relative;margin-top:6px}
    .suggest-list{position:absolute;left:0;right:0;top:100%;z-index:20;margin-top:6px;background:#0d1420;border:1px solid var(--stroke);border-radius:10px;box-shadow:var(--shadow);display:none;max-height:220px;overflow:auto}
    .s-item{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.04);cursor:pointer}
    .s-item:last-child{border-bottom:0}
    .s-primary{font-weight:700}
    .s-secondary{color:var(--dim);font-size:12px}
    .s-actions{display:flex;gap:6px}
    .chip-del{background:#1a2433;border:1px solid #223046;color:#cbd5e1;border-radius:8px;padding:2px 6px;font-size:12px;cursor:pointer}

    /* Inline save */
    .inline-save{display:none;gap:6px;align-items:center;margin-top:8px}
    .inline-save input{height:36px;padding:8px 10px;border-radius:8px;font-size:14px}
    .inline-save .ok{background:#0f2a18;border:1px solid #1f6d3a}
    .inline-save .ko{background:#2a0f15;border:1px solid #6d1f2c}

    /* Dial selector */
    .phone-row{display:flex;gap:8px;align-items:center}
    .dial{position:relative;display:flex;gap:6px}
    .dial-btn{height:36px;padding:0 10px;border-radius:8px;border:1px solid var(--stroke);background:#0a1220;color:#e6edf3;display:inline-flex;align-items:center;gap:6px;cursor:pointer}
    .dial-btn:hover{background:#0d1729}
    .dial-panel{position:absolute;left:0;top:44px;z-index:30;width:260px;background:#0d1420;border:1px solid var(--stroke);border-radius:10px;box-shadow:var(--shadow);display:none}
    .dial-head{display:flex;align-items:center;gap:6px;padding:8px 10px;border-bottom:1px solid rgba(255,255,255,.06)}
    .dial-head .loupe{font-size:16px}
    .dial-search-input{flex:1;height:32px;border:1px solid var(--stroke);background:#0e141c;color:#e6edf3;border-radius:8px;padding:0 8px;outline:none}
    .dial-list{max-height:260px;overflow:auto}
    .dial-item{display:flex;align-items:center;gap:8px;padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.04);cursor:pointer}
    .dial-item:last-child{border-bottom:0}
    .flag{font-size:16px}
    .dialcode{color:#cfe1ff}
    .country{color:#9fb0c0;font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" aria-label="Preview Listes blanches + Indicatif">
      <h1>Preview ‚Äî Liste blanche (envoyeur) + indicatif</h1>
      <p class="sub">Enregistre un num√©ro (üíæ), affiche tes enregistr√©s (üìñ). Choisis rapidement l‚Äôindicatif (üá´üá∑ +33) et filtre dans le panneau.</p>

      <label for="wallet">Ton wallet (exp√©diteur)</label>
      <input id="wallet" placeholder="0xABCDEF..." autocomplete="off"/>

      <div class="row">
        <div class="col">
          <label for="currency">Token</label>
          <select id="currency"><option>USDT</option><option>USDC</option><option>ETH</option></select>
        </div>
        <div class="col">
          <label for="amount">Montant (crypto)</label>
          <input id="amount" placeholder="0.01" inputmode="decimal"/>
        </div>
      </div>

      <label for="network">R√©seau</label>
      <select id="network"><option>Ethereum</option><option>Polygon</option><option>BNB Chain</option><option>Solana</option></select>

      <!-- === Zone num√©ro + indicatif === -->
      <label for="phone">Num√©ro du destinataire</label>
      <div class="phone-row">
        <!-- Dial selector -->
        <div class="dial">
          <button id="dialBtn" class="dial-btn" type="button"><span class="flag">üá´üá∑</span><span id="dialCode">+33</span></button>
          <div id="dialPanel" class="dial-panel" role="dialog" aria-modal="true">
            <div class="dial-head">
              <span class="loupe">üîé</span>
              <input id="dialSearch" class="dial-search-input" autocomplete="off" aria-label="Rechercher"/>
            </div>
            <div id="dialList" class="dial-list"></div>
          </div>
        </div>
        <!-- Phone input -->
        <input id="phone" placeholder="612345678" autocomplete="off"/>
      </div>

      <!-- Num√©ro + suggestions (contacts) -->
      <div class="suggest">
        <div id="suggestList" class="suggest-list" role="listbox"></div>
      </div>

      <!-- boutons compacts (üìñ puis üíæ) -->
      <div class="row" style="margin-top:8px">
        <button id="showAllBtn" class="btn-icon" type="button" title="Afficher mes contacts">üìñ</button>
        <button id="saveBtn" class="btn-icon" type="button" title="Enregistrer ce num√©ro">üíæ</button>
      </div>

      <!-- petit champ inline pour le pseudo -->
      <div id="inlineSave" class="inline-save">
        <input id="aliasInput" placeholder="Nom / pseudo" autocomplete="off" />
        <button id="aliasOk" class="btn-icon ok" type="button" title="Valider">‚úÖ</button>
        <button id="aliasKo" class="btn-icon ko" type="button" title="Annuler">‚úñÔ∏è</button>
      </div>

      <button class="btn" disabled>G√©n√©rer le lien (d√©sactiv√© dans le preview)</button>
    </div>
  </div>

  <script>
    // =============================
    // Donn√©es pays (drapeau + code)
    // =============================
    const DIALS = [
      {flag:"üá´üá∑",code:"+33",name:"France"},
      {flag:"üá™üá∏",code:"+34",name:"Espagne"},
      {flag:"üáßüá™",code:"+32",name:"Belgique"},
      {flag:"üá®üá≠",code:"+41",name:"Suisse"},
      {flag:"üá©üá™",code:"+49",name:"Allemagne"},
      {flag:"üáÆüáπ",code:"+39",name:"Italie"},
      {flag:"üáµüáπ",code:"+351",name:"Portugal"},
      {flag:"üá¨üáß",code:"+44",name:"Royaume-Uni"},
      {flag:"üá∫üá∏",code:"+1", name:"√âtats-Unis"},
      {flag:"üá®üá¶",code:"+1", name:"Canada"},
      {flag:"üá≤üá¶",code:"+212",name:"Maroc"},
      {flag:"üá©üáø",code:"+213",name:"Alg√©rie"},
      {flag:"üáπüá≥",code:"+216",name:"Tunisie"},
      {flag:"üá∏üá≥",code:"+221",name:"S√©n√©gal"},
      {flag:"üá®üáÆ",code:"+225",name:"C√¥te d‚ÄôIvoire"},
      {flag:"üá®üá≤",code:"+237",name:"Cameroun"},
      {flag:"üáπüá¨",code:"+228",name:"Togo"},
      {flag:"üá≤üá±",code:"+223",name:"Mali"},
      {flag:"üá∑üá∫",code:"+7", name:"Russie"},
      {flag:"üáπüá∑",code:"+90",name:"Turquie"},
      {flag:"üá¶üá™",code:"+971",name:"√âmirats"},
      {flag:"üáÆüá≥",code:"+91",name:"Inde"},
      {flag:"üá®üá≥",code:"+86",name:"Chine"},
      {flag:"üáØüáµ",code:"+81",name:"Japon"},
      {flag:"üá∞üá∑",code:"+82",name:"Cor√©e du Sud"},
      {flag:"üáßüá∑",code:"+55",name:"Br√©sil"},
      {flag:"üá≤üáΩ",code:"+52",name:"Mexique"},
      {flag:"üá¶üá∑",code:"+54",name:"Argentine"},
      {flag:"üá®üá±",code:"+56",name:"Chili"},
      {flag:"üá¶üá∫",code:"+61",name:"Australie"},
      {flag:"üá≥üáø",code:"+64",name:"Nouvelle-Z√©lande"},
    ];

    const $ = (s)=>document.querySelector(s);

    // =============================
    // S√©lecteur d‚Äôindicatif
    // =============================
    const dialBtn = $("#dialBtn");
    const dialCodeSpan = $("#dialCode");
    const dialPanel = $("#dialPanel");
    const dialSearch = $("#dialSearch");
    const dialList = $("#dialList");

    let currentDial = {flag:"üá´üá∑", code:"+33"}; // d√©faut

    function renderDialList(filter=""){
      const f = (filter||"").trim().toLowerCase();
      dialList.innerHTML = "";
      DIALS.filter(d => !f || d.name.toLowerCase().includes(f) || d.code.includes(f))
           .forEach(d=>{
              const row = document.createElement("div");
              row.className = "dial-item";
              row.innerHTML = `<span class="flag">${d.flag}</span><span class="dialcode">${d.code}</span><span class="country">${d.name}</span>`;
              row.onclick = ()=>{
                currentDial = {flag:d.flag, code:d.code};
                dialBtn.innerHTML = `<span class="flag">${d.flag}</span><span id="dialCode">${d.code}</span>`;
                dialPanel.style.display = "none";
              };
              dialList.appendChild(row);
           });
    }
    function openDialPanel(){
      renderDialList("");
      dialPanel.style.display = "block";
      setTimeout(()=>dialSearch.focus(), 0);
    }
    function closeDialPanel(){ dialPanel.style.display="none"; }

    dialBtn.addEventListener("click", ()=>{
      if (dialPanel.style.display === "block") closeDialPanel(); else openDialPanel();
    });
    dialSearch.addEventListener("input", ()=>renderDialList(dialSearch.value));
    document.addEventListener("click",(e)=>{
      if (!dialPanel.contains(e.target) && e.target!==dialBtn) closeDialPanel();
    });

    // =============================
    // Liste blanche (contacts)
    // =============================
    const LS_KEY = "linkisend_contacts"; // [{ id, name, phone, created }]
    const phoneInput = $("#phone");
    const suggestEl = $("#suggestList");
    const inlineSave = $("#inlineSave");
    const aliasInput = $("#aliasInput");
    const showAllBtn = $("#showAllBtn");
    const saveBtn = $("#saveBtn");
    const aliasOk = $("#aliasOk");
    const aliasKo = $("#aliasKo");

    function loadContacts(){ try { return JSON.parse(localStorage.getItem(LS_KEY)||"[]"); } catch { return []; } }
    function saveContacts(list){ localStorage.setItem(LS_KEY, JSON.stringify(list)); }
    function addContact(name, phone){
      const list = loadContacts();
      const idx = list.findIndex(c=>c.phone===phone);
      const item = { id:(crypto.randomUUID?crypto.randomUUID():String(Date.now())), name, phone, created:Date.now() };
      if (idx>=0) list[idx]=item; else list.unshift(item);
      saveContacts(list);
    }
    function removeContact(id){ saveContacts(loadContacts().filter(c=>c.id!==id)); }

    function closeSuggest(){ suggestEl.style.display="none"; suggestEl.innerHTML=""; }
    function openSuggest(){ suggestEl.style.display="block"; }

    function escapeHtml(str){ return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[s])); }

    function renderSuggest(filter=""){
      const data=loadContacts();
      const f=(filter||"").trim().toLowerCase();
      const rows=data.filter(c=>!f || c.name.toLowerCase().includes(f) || c.phone.includes(filter));
      suggestEl.innerHTML="";
      if (!rows.length){ closeSuggest(); return; }
      rows.forEach(c=>{
        const row=document.createElement("div");
        row.className="s-item";
        row.innerHTML=`
          <div>
            <div class="s-primary">${escapeHtml(c.name)}</div>
            <div class="s-secondary">${escapeHtml(c.phone)}</div>
          </div>
          <div class="s-actions"><button class="chip-del" data-id="${c.id}" type="button" aria-label="Supprimer">üóëÔ∏è</button></div>`;
        row.addEventListener("click",(e)=>{
          const t=e.target;
          if (t && t.classList && t.classList.contains("chip-del")) return;
          phoneInput.value=c.phone; closeSuggest();
        });
        const del=row.querySelector(".chip-del");
        if (del){ del.addEventListener("click",(e)=>{ e.stopPropagation(); removeContact(c.id); renderSuggest(filter); }); }
        suggestEl.appendChild(row);
      });
      openSuggest();
    }

    // La liste n‚Äôappara√Æt QUE via l‚Äôemoji üìñ
    showAllBtn.addEventListener("click", ()=>{
      const has = loadContacts().length>0;
      if (!has){ closeSuggest(); return; }
      renderSuggest(""); openSuggest(); phoneInput.focus();
    });
    document.addEventListener("click",(e)=>{
      if (!suggestEl.contains(e.target) && e.target!==showAllBtn) closeSuggest();
    });

    // Enregistrer (üíæ) ‚Üí petit champ inline
    saveBtn.addEventListener("click", ()=>{
      const phone = phoneInput.value.trim();
      if (!phone){ alert("Entre un num√©ro avant d‚Äôenregistrer."); return; }
      inlineSave.style.display="flex"; aliasInput.value=""; aliasInput.focus();
    });
    aliasOk.addEventListener("click", ()=>{
      const phone = phoneInput.value.trim();
      const name = aliasInput.value.trim();
      if (!name){ aliasInput.focus(); return; }
      addContact(name, phone);
      inlineSave.style.display="none";
      // pas d‚Äôouverture auto de la liste (seulement via üìñ)
    });
    aliasKo.addEventListener("click", ()=>{ inlineSave.style.display="none"; aliasInput.value=""; });

    // (facultatif) Concat√©ner indicatif + num√©ro : currentDial.code + phoneInput.value.trim()
  </script>
</body>
</html>
