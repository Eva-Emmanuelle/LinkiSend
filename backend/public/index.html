<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LinkiSend — Envoyer des cryptos</title>

  <!-- Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      /* Thème sombre */
      --bg:#111827;          /* fond général */
      --panel:#1f2937;       /* cartes / inputs */
      --panel-2:#111827;     /* éléments secondaires */
      --text:#f9fafb;        /* texte principal */
      --muted:#9ca3af;       /* texte secondaire */
      --border:#374151;      /* bords discrets */

      --brand:#22c55e;       /* vert bouton principal */
      --brand-press:#16a34a; /* vert pressé */
      --accent:#60a5fa;      /* bleu léger (CTA wallet) */

      --shadow:0 10px 30px rgba(0,0,0,.45);
      --radius:16px;
      --radius-sm:12px;
      --radius-xs:10px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
      background:var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .wrap{
      min-height:100%;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:40px 16px 80px;
    }

    .container{
      width:100%;
      max-width:520px;
    }

    .badge{
      display:inline-block;
      padding:6px 12px;
      border-radius:999px;
      font-weight:600;
      font-size:12px;
      background:rgba(96,165,250,.12);
      color:#bfdbfe;
      border:1px solid rgba(96,165,250,.25);
      margin-bottom:16px;
    }

    h1{
      margin:0 0 8px;
      font-size:28px;
      line-height:1.15;
      letter-spacing:-.01em;
    }

    .subtitle{
      color:var(--muted);
      margin-bottom:22px;
    }

    .card{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:22px;
    }

    .row{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }

    .label{
      font-size:13px;
      color:var(--muted);
      margin-bottom:8px;
      display:block;
    }

    input, select{
      width:100%;
      padding:12px 14px;
      border-radius:var(--radius-xs);
      border:1px solid var(--border);
      background:#0b1220; /* plus sombre à l'intérieur */
      color:var(--text);
      outline:none;
      transition:border-color .15s ease, box-shadow .15s ease;
    }
    input::placeholder{color:#6b7280}
    select{background:#0b1220}

    input:focus, select:focus{
      border-color:#60a5fa;
      box-shadow:0 0 0 4px rgba(96,165,250,.12);
    }

    .wallet-connect{
      display:inline-flex;
      align-items:center;
      gap:10px;
      font-weight:600;
      color:#dbeafe;             /* texte bleu très clair */
      background:#0b1830;        /* puce bleutée */
      border:1px solid rgba(96,165,250,.35);
      padding:10px 14px;
      border-radius:var(--radius-xs);
      cursor:pointer;
      text-decoration:none;
      user-select:none;
      transition:transform .05s ease, background .15s ease, border-color .15s ease;
      width:fit-content;
    }
    .wallet-connect:hover{
      background:#0d1f3f;
      border-color:#60a5fa;
    }
    .wallet-connect:active{transform:translateY(1px)}
    .wallet-connect[aria-disabled="true"]{
      opacity:.7; cursor:default; pointer-events:none;
    }

    .meta-icon{
      width:18px;height:18px;display:inline-block;
      background:linear-gradient(135deg,#60a5fa,#93c5fd);
      border-radius:4px;
    }

    .btn-primary{
      display:block;
      width:100%;
      padding:14px 16px;
      border:none;
      border-radius:var(--radius-sm);
      background:var(--brand);
      color:white;
      font-weight:700;
      font-size:16px;
      cursor:pointer;
      transition:transform .05s ease, background .15s ease, box-shadow .15s ease;
      box-shadow:0 8px 20px rgba(34,197,94,.18);
    }
    .btn-primary:hover{background:var(--brand-press)}
    .btn-primary:active{transform:translateY(1px)}
    .btn-primary:disabled{
      opacity:.6; cursor:not-allowed; box-shadow:none;
    }

    .footnote{
      margin-top:12px;
      text-align:center;
      font-size:13px;
      color:var(--muted);
    }

    /* Modal */
    .modal-backdrop{
      position:fixed; inset:0;
      background:rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:50;
    }
    .modal{
      width:100%;
      max-width:420px;
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow:var(--shadow);
      padding:18px;
    }
    .modal-header{
      display:flex; align-items:center; justify-content:space-between;
      margin-bottom:12px;
    }
    .modal-title{font-weight:700}
    .close-x{
      background:transparent; border:none; color:var(--muted);
      font-size:20px; cursor:pointer; line-height:1;
    }
    .wallet-grid{
      display:grid; gap:10px;
      grid-template-columns:1fr;
      margin-top:10px;
    }
    .wallet-option{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; padding:12px 14px;
      background:#0b1220; border:1px solid var(--border);
      border-radius:12px; cursor:pointer;
      transition:border-color .15s ease, transform .05s ease;
    }
    .wallet-option:hover{border-color:#60a5fa}
    .wallet-option:active{transform:translateY(1px)}
    .wallet-name{font-weight:600}
    .tag{
      font-size:12px; padding:4px 8px; border-radius:999px;
      background:#132a1b; color:#86efac; border:1px solid rgba(34,197,94,.25);
    }
    .tag-soon{
      background:#33240f; color:#fcd34d; border:1px solid rgba(245,158,11,.25);
    }

    /* Helpers */
    .mt-8{margin-top:8px}
    .mt-12{margin-top:12px}
    .mt-16{margin-top:16px}
    .mt-20{margin-top:20px}
    .mb-6{margin-bottom:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="container">
      <span class="badge">LinkiSend</span>
      <h1>Envoyer des cryptos</h1>
      <div class="subtitle">Génère un lien de virement en 10&nbsp;secondes.</div>

      <div class="card">
        <div class="row">
          <div>
            <label class="label" for="token">Token</label>
            <select id="token">
              <option value="USDT" selected>USDT</option>
              <option value="USDC">USDC</option>
              <option value="ETH">ETH</option>
            </select>
          </div>
          <div>
            <label class="label" for="amount">Montant (crypto)</label>
            <input id="amount" type="number" min="0" step="any" placeholder="0.01" />
          </div>
        </div>

        <div class="mt-16">
          <label class="label" for="sender">Ton wallet (expéditeur)</label>
          <input id="sender" type="text" placeholder="0xABCDEF..." autocomplete="off" readonly />
        </div>

        <div class="mt-12">
          <a id="openWalletModal" class="wallet-connect" role="button" aria-controls="walletModal" aria-expanded="false">
            <span class="meta-icon" aria-hidden="true"></span>
            <span>Connecter mon wallet</span>
          </a>
        </div>

        <div class="mt-16">
          <label class="label" for="phone">Numéro du destinataire</label>
          <input id="phone" type="tel" placeholder="+33..." inputmode="tel" />
        </div>

        <div class="mt-16">
          <label class="label" for="network">Réseau</label>
          <select id="network">
            <option value="ethereum" selected>Ethereum</option>
            <option value="polygon">Polygon</option>
            <option value="bsc">BNB Chain</option>
            <option value="arbitrum">Arbitrum</option>
            <option value="base">Base</option>
          </select>
        </div>

        <button id="generate" class="btn-primary mt-20">Générer le lien</button>
        <div class="footnote">Aucun transfert on-chain n’est effectué tant que le lien n’est pas réclamé.</div>
      </div>
    </div>
  </div>

  <!-- Modal Wallet -->
  <div id="walletModalBackdrop" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="walletModalTitle">
      <div class="modal-header">
        <div id="walletModalTitle" class="modal-title">Connecter un wallet</div>
        <button class="close-x" id="closeWalletModal" aria-label="Fermer">×</button>
      </div>
      <div class="subtitle mb-6">Choisis une méthode de connexion&nbsp;:</div>

      <div class="wallet-grid">
        <div id="connectMetaMask" class="wallet-option" role="button" tabindex="0">
          <div class="wallet-name">MetaMask</div>
          <span class="tag">Supporté</span>
        </div>

        <div class="wallet-option" role="button" aria-disabled="true" tabindex="-1" style="opacity:.6; cursor:not-allowed;">
          <div class="wallet-name">WalletConnect</div>
          <span class="tag tag-soon">Bientôt</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------- Helpers ----------
    const $ = (s) => document.querySelector(s);
    const openModal = () => {
      const back = $('#walletModalBackdrop');
      back.style.display = 'flex';
      $('#openWalletModal').setAttribute('aria-expanded','true');
      back.setAttribute('aria-hidden','false');
    };
    const closeModal = () => {
      const back = $('#walletModalBackdrop');
      back.style.display = 'none';
      $('#openWalletModal').setAttribute('aria-expanded','false');
      back.setAttribute('aria-hidden','true');
    };

    // ---------- UI wiring ----------
    $('#openWalletModal').addEventListener('click', openModal);
    $('#closeWalletModal').addEventListener('click', closeModal);
    $('#walletModalBackdrop').addEventListener('click', (e)=>{
      if(e.target === e.currentTarget) closeModal();
    });
    document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') closeModal(); });

    // ---------- MetaMask connect ----------
    async function connectMetaMask(){
      const connectBtn = $('#openWalletModal');
      try{
        if(!window.ethereum){
          alert("MetaMask introuvable. Installe l’extension puis réessaie.");
          return;
        }
        connectBtn.setAttribute('aria-disabled','true');

        // Demande d'accès aux comptes
        const accounts = await window.ethereum.request({ method:'eth_requestAccounts' });
        const account = (accounts && accounts[0]) ? accounts[0] : null;
        if(!account){
          alert("Aucun compte sélectionné.");
          connectBtn.removeAttribute('aria-disabled');
          return;
        }

        // Mise à jour UI
        const sender = $('#sender');
        sender.value = account;
        sender.dataset.connected = 'true';

        connectBtn.innerHTML = '<span class="meta-icon" aria-hidden="true"></span><span>Wallet connecté</span>';
        connectBtn.setAttribute('aria-disabled','true');

        closeModal();

        // Optionnel : écouter les changements de compte
        if(window.ethereum && window.ethereum.on){
          window.ethereum.removeAllListeners?.('accountsChanged');
          window.ethereum.on('accountsChanged', (accs)=>{
            if(accs && accs[0]){
              sender.value = accs[0];
            }else{
              sender.value = '';
              connectBtn.innerHTML = '<span class="meta-icon" aria-hidden="true"></span><span>Connecter mon wallet</span>';
              connectBtn.removeAttribute('aria-disabled');
            }
          });
        }
      }catch(err){
        console.error(err);
        alert("Connexion MetaMask annulée ou échouée.");
        $('#openWalletModal').removeAttribute('aria-disabled');
      }
    }

    $('#connectMetaMask').addEventListener('click', connectMetaMask);
    $('#connectMetaMask').addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') connectMetaMask(); });

    // ---------- Bouton "Générer le lien" (placeholder côté frontend) ----------
    $('#generate').addEventListener('click', ()=>{
      const sender = $('#sender').value.trim();
      if(!sender){
        alert("Connecte d’abord ton wallet.");
        return;
      }
      // Ici on ne touche pas à ton backend : simple garde-fou UX.
      // La suite (appel au backend) restera exactement comme dans ta version validée.
      alert("Parfait. Le wallet est connecté. Tu peux maintenant générer le lien (logique backend inchangée).");
    });
  </script>
</body>
</html>
