<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>LinkiSend ‚Äî Envoyer des cryptos</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <!-- PWA iOS (splash & mode app) -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="assets/icons/icon-maskable-512.png">
  <meta name="theme-color" content="#0b0f14">
  <style>
    /* ... styles inchang√©s ... */
  </style>
</head>
<body>
  <!-- Splash, Gate PWA, Branding etc. inchang√©s -->

  <div class="wrap">
    <div class="brand">
      <img src="assets/branding/logo-arrow.svg" alt="Fl√®che" class="arrow" />
      <img src="assets/branding/logo-word.svg" alt="LinkiSend" class="word" />
      <span id="langToggle" class="lang-toggle">FR / EN</span>
    </div>

    <div class="card">
      <h2 id="title">Envoyer des cryptos</h2>
      <p class="sub" id="subtitle">G√©n√®re un lien en 10&nbsp;secondes.</p>

      <!-- 1) WALLET -->
      <label for="wallet" id="lbl-wallet">Ton wallet (exp√©diteur)</label>
      <input type="text" id="wallet" placeholder="0xABCDEF..." autocomplete="off" />
      <a href="#" id="connectWalletLink" class="wallet-link" aria-haspopup="dialog">Connecter un wallet</a>

      <!-- 2) TOKEN & MONTANT -->
      <div class="row">
        <div class="col">
          <label for="currency" id="lbl-token">Token</label>
          <select id="currency"></select>
        </div>
        <div class="col">
          <label for="amount" id="lbl-amount">Montant</label>
          <input type="number" id="amount" inputmode="decimal" min="0" step="0.00001" placeholder="0.01" />
        </div>
      </div>

      <!-- 3) R√âSEAU -->
      <label for="network" id="lbl-network">R√©seau</label>
      <select id="network">
        <option>Ethereum</option>
        <option>BNB Chain</option>
        <option>Polygon</option>
        <option>Solana</option>
        <option>Avalanche</option>
      </select>

      <!-- 4) T√âL√âPHONE -->
      <label id="lbl-phone">Num√©ro du destinataire</label>
      <div class="phone-row">
        <div class="dial">
          <button id="dialBtn" class="dial-btn"><span class="iso">FR</span><span id="dialCode">+33</span></button>
          <div id="dialPanel" class="dial-panel">
            <div class="dial-head"><input id="dialSearch" class="dial-search-input" placeholder="Rechercher..."/></div>
            <div id="dialList" class="dial-list"></div>
          </div>
        </div>
        <input type="text" id="phone" placeholder="612345678" inputmode="tel"/>
      </div>

      <div class="contact-actions">
        <span class="emoji-btn" id="showContacts">üìñ</span>
        <span class="emoji-btn" id="saveContact">üíæ</span>
      </div>
      <div class="contacts" id="contactsList"></div>

      <button id="generateBtn" class="btn">G√©n√©rer le lien</button>
      <p class="hint" id="hint">Aucun transfert on-chain n‚Äôest effectu√© tant que le lien n‚Äôest pas r√©clam√©.</p>

      <div id="result" class="result-cta">
        <h3 id="resultTitle">Lien pr√™t ‚úÖ</h3>
        <div class="row-cta"><code id="the-link"></code><span id="copyLinkBtn">üìã</span></div>
        <div id="validityText" class="sub-cta">‚è≥ Validit√© : 24h ‚Ä¢ Aucun transfert on-chain n‚Äôa lieu tant que le lien n‚Äôest pas r√©clam√©.</div>
      </div>
      <div id="error" class="error" style="display:none"></div>
    </div>
  </div>

  <div class="toast" id="toast">Lien copi√© ‚úÖ</div>

  <!-- Modal wallets -->
  <div class="modal" id="walletModal">
    <div class="modal-card">
      <div class="modal-head">
        <h3 id="walletModalTitle">Connecter un wallet</h3>
        <button class="x" id="walletModalClose">‚úï</button>
      </div>
      <div class="providers">
        <button class="pv" data-wallet="metamask"><img src="assets/wallets/metamask.svg" alt="MetaMask" /> MetaMask <span class="tag">EVM</span></button>
        <button class="pv" data-wallet="phantom"><img src="assets/wallets/phantom.svg" alt="Phantom" /> Phantom <span class="tag">Solana</span></button>
      </div>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', ()=>{
    const walletInput = document.getElementById('wallet');
    const currencySelect = document.getElementById('currency');

    function setOptions(list){
      currencySelect.innerHTML = '';
      list.forEach(sym=>{
        const o=document.createElement('option'); o.value=sym; o.textContent=sym;
        currencySelect.appendChild(o);
      });
    }

    async function loadEvmTokens(eth, account){
      const chainId = await eth.request({ method:'eth_chainId' });
      const balances = [];

      // natif
      const native = { "0x1":"ETH", "0x38":"BNB", "0x89":"MATIC", "0xa86a":"AVAX" }[chainId] || "ETH";
      balances.push(native);

      // ERC20 standards
      const TOKENS = {
        "0x1": {
          USDT:"0xdAC17F958D2ee523a2206206994597C13D831ec7",
          USDC:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606EB48",
          DAI:"0x6B175474E89094C44Da98b954EedeAC495271d0F",
          WBTC:"0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599"
        }
      };
      if (TOKENS[chainId]){
        for(const sym in TOKENS[chainId]) balances.push(sym);
      }
      setOptions(balances);
    }

    async function loadSolanaTokens(address){
      const list=["SOL","USDC","USDT","BONK","RAY"];
      setOptions(list);
    }

    // Modal
    const modal = document.getElementById('walletModal');
    document.getElementById('connectWalletLink').onclick=(e)=>{e.preventDefault(); modal.style.display='grid';};
    document.getElementById('walletModalClose').onclick=()=>{modal.style.display='none';};
    modal.addEventListener('click',e=>{ if(e.target===modal) modal.style.display='none'; });

    modal.querySelectorAll('.pv').forEach(btn=>{
      btn.addEventListener('click', async ()=>{
        const type=btn.dataset.wallet;
        if(type==="metamask"){
          const eth = window.ethereum;
          if(!eth){alert("MetaMask non d√©tect√©");return;}
          try{
            const accs = await eth.request({method:"eth_requestAccounts"});
            if(accs && accs[0]){ walletInput.value=accs[0]; await loadEvmTokens(eth, accs[0]); }
            modal.style.display='none';
          }catch(e){alert("Erreur MetaMask");}
        }
        if(type==="phantom"){
          if(window.solana && window.solana.isPhantom){
            try{
              const resp = await window.solana.connect();
              const addr = resp.publicKey.toString();
              walletInput.value=addr;
              await loadSolanaTokens(addr);
              modal.style.display='none';
            }catch(e){alert("Erreur Phantom");}
          } else { window.open("https://phantom.app/","_blank"); }
        }
      });
    });
  });
  </script>
</body>
</html>
